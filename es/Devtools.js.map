{"version":3,"file":"Devtools.js","sourceRoot":"","sources":["../src/Devtools.ts"],"names":[],"mappings":"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","sourcesContent":["import { IS_PROXY } from 'proxy-state-tree'\nimport isPlainObject from 'is-plain-obj'\n\nexport type Message = {\n  type: string\n  data?: object\n}\n\nexport function safeValue(value) {\n  if (\n    typeof value === 'object' &&\n    !Array.isArray(value) &&\n    value !== null &&\n    !isPlainObject(value)\n  ) {\n    return `[${value.constructor.name || 'NOT SERIALIZABLE'}]`\n  }\n\n  return value && !value[IS_PROXY] && isPlainObject(value)\n    ? Object.keys(value).reduce((aggr, key) => {\n        aggr[key] = safeValue(value[key])\n\n        return aggr\n      }, {})\n    : value\n}\n\nexport function safeValues(values) {\n  return values.map(safeValue)\n}\n\nconst throttle = (func, limit) => {\n  let lastFunc\n  let lastRan\n  return function() {\n    const context = this\n    const args = arguments\n    if (!lastRan) {\n      func.apply(context, args)\n      lastRan = Date.now()\n    } else {\n      clearTimeout(lastFunc)\n      lastFunc = setTimeout(function() {\n        if (Date.now() - lastRan >= limit) {\n          func.apply(context, args)\n          lastRan = Date.now()\n        }\n      }, limit - (Date.now() - lastRan))\n    }\n  }\n}\n\nexport class Devtools {\n  private buffer: string[] = []\n  private ws: WebSocket\n  private isConnected: boolean = false\n  private doReconnect: boolean = false\n  private hasWarnedReconnect: boolean = false\n  private reconnectInterval: number = 10000\n  private name: string\n  constructor(name: string) {\n    this.name = name\n  }\n  connect = (host: string, onMessage: (message: Message) => void) => {\n    host = host || 'localhost:3031'\n\n    this.ws = new WebSocket(`ws://${host}`)\n    this.ws.onmessage = (event) => onMessage(JSON.parse(event.data))\n    this.ws.onopen = () => {\n      this.isConnected = true\n      this.sendBuffer()\n    }\n    this.ws.onerror = () => {}\n    this.ws.onclose = () => {\n      this.isConnected = false\n\n      if (this.doReconnect && !this.hasWarnedReconnect) {\n        console.warn(\n          'Debugger application is not running on selected port... will reconnect automatically behind the scenes'\n        )\n        this.hasWarnedReconnect = true\n      }\n\n      if (this.doReconnect) {\n        this.reconnect(host, onMessage)\n      }\n    }\n  }\n  private reconnect(host, onMessage) {\n    setTimeout(\n      () =>\n        this.connect(\n          host,\n          onMessage\n        ),\n      this.reconnectInterval\n    )\n  }\n  send(message: Message) {\n    const stringifiedMessage = JSON.stringify(message)\n    ;(window['__zone_symbol__setTimeout'] || setTimeout)(() => {\n      this.buffer.push(stringifiedMessage)\n      this.sendBuffer()\n    })\n  }\n  private sendBuffer = throttle(function() {\n    if (this.isConnected && this.buffer.length) {\n      this.ws.send(\n        `{ \"appName\": \"${this.name}\", \"messages\": [${this.buffer.join(',')}] }`\n      )\n      this.buffer.length = 0\n    }\n  }, 50)\n}\n"]}