{"version":3,"file":"proxyfyEffects.js","sourceRoot":"","sources":["../src/proxyfyEffects.ts"],"names":[],"mappings":"AAAA,MAAM,CAAC,MAAM,UAAU,GAAG,MAAM,CAAC,YAAY,CAAC,CAAA;AAE9C,SAAS,QAAQ,CAAC,KAAK;IACrB,OAAO,OAAO,KAAK,KAAK,QAAQ,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,KAAK,IAAI,CAAA;AAC7E,CAAC;AAED,IAAI,oBAAoB,GAAG,KAAK,CAAA;AAChC,IAAI,eAAe,GAAG,CAAC,CAAA;AAEvB,SAAS,UAAU,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE;IACxC,MAAM,IAAI,GAAG,UAAS,GAAG,IAAI;QAC3B,MAAM,QAAQ,GAAG,eAAe,EAAE,CAAA;QAElC,OAAO,EAAE,CAAC;YACR,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC;YAC/B,QAAQ;YACR,IAAI,EAAE,IAAI;YACV,MAAM,EAAE,IAAI;YACZ,IAAI;SACL,CAAC,CAAA;IACJ,CAAC,CAAA;IAED,OAAO,IAAI,KAAK,CAAC,IAAI,EAAE;QACrB,SAAS,CAAC,CAAC,EAAE,IAAI;YACf,IAAI,CAAC,oBAAoB,EAAE;gBACzB,OAAO,CAAC,IAAI,CACV,yHAAyH,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE,yDAAyD,CAC1M,CAAA;gBACD,oBAAoB,GAAG,IAAI,CAAA;aAC5B;YAED,OAAO,IAAI,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAA;QAClC,CAAC;KACF,CAAC,CAAA;AACJ,CAAC;AAED,SAAS,qBAAqB,CAC5B,IAAY,EACZ,EAAoB;IAEpB,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,EAAE;QACtB,IAAI,OAAO,MAAM,CAAC,IAAI,CAAC,KAAK,UAAU,EAAE;YACtC,OAAO,UAAU,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,CAAC,CAAA;SAC1C;QAED,IAAI,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE;YAC1B,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;gBAC7B,GAAG,EAAE,qBAAqB,CACxB,IAAI,CAAC,CAAC,CAAC,IAAI,GAAG,GAAG,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,EACrD,EAAE,CACH;aACF,CAAC,CAAA;SACH;QACD,OAAO,MAAM,CAAC,IAAI,CAAC,CAAA;IACrB,CAAC,CAAA;AACH,CAAC;AAED,MAAM,UAAU,cAAc,CAC5B,OAAgB,EAChB,EAAoB;IAEpB,OAAO,IAAI,KAAK,CAAC,OAAO,EAAE;QACxB,GAAG,EAAE,qBAAqB,CAAC,EAAE,EAAE,EAAE,CAAC;KACnC,CAAC,CAAA;AACJ,CAAC","sourcesContent":["export const doNotProxy = Symbol('doNotProxy')\n\nfunction isObject(value) {\n  return typeof value === 'object' && !Array.isArray(value) && value !== null\n}\n\nlet hasWarnedConstructor = false\nlet currentEffectId = 0\n\nfunction wrapEffect(target, prop, path, cb) {\n  const func = function(...args) {\n    const effectId = currentEffectId++\n\n    return cb({\n      func: target[prop].bind(target),\n      effectId,\n      name: path,\n      method: prop,\n      args,\n    })\n  }\n\n  return new Proxy(func, {\n    construct(_, args) {\n      if (!hasWarnedConstructor) {\n        console.warn(\n          `EFFECTS - It is highly recommended to create a custom effect, exposing a method that deals with the instantiation of \"${path}.${prop.toString()}\". It improves readability and debugability of your app`\n        )\n        hasWarnedConstructor = true\n      }\n\n      return new target[prop](...args)\n    },\n  })\n}\n\nfunction createProxyGetHandler(\n  path: string,\n  cb: (effect) => void\n): ProxyHandler<any>['get'] {\n  return (target, prop) => {\n    if (typeof target[prop] === 'function') {\n      return wrapEffect(target, prop, path, cb)\n    }\n\n    if (isObject(target[prop])) {\n      return new Proxy(target[prop], {\n        get: createProxyGetHandler(\n          path ? path + '.' + prop.toString() : prop.toString(),\n          cb\n        ),\n      })\n    }\n    return target[prop]\n  }\n}\n\nexport function proxifyEffects<Effects>(\n  effects: Effects,\n  cb: (effect) => void\n): Effects {\n  return new Proxy(effects, {\n    get: createProxyGetHandler('', cb),\n  })\n}\n"]}